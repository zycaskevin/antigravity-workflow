name: AGW Integrity Check

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  integrity-check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Verify Core Files
      run: |
        if [ ! -f "GEMINI.md" ]; then
          echo "‚ùå Error: GEMINI.md not found!"
          exit 1
        fi
        if [ ! -f "README.md" ]; then
          echo "‚ùå Error: README.md not found!"
          exit 1
        fi
        echo "‚úÖ Core files present."

    - name: Verify Agent Structure
      run: |
        if [ ! -d ".agent/rules" ]; then
          echo "‚ùå Error: .agent/rules directory missing!"
          exit 1
        fi
        if [ ! -d ".agent/workflows" ]; then
          echo "‚ùå Error: .agent/workflows directory missing!"
          exit 1
        fi
        echo "‚úÖ Agent structure valid."

    - name: Check Content Security (Basic)
      run: |
        # Simply check if any file contains "password" or "api_key" (case insensitive)
        # excluding git and typical safe locations
        if grep -rNi "api_key" . --exclude-dir=.git --exclude=*.md; then
          echo "‚ö†Ô∏è Warning: Possible API Key reference found (outside markdown)."
          # specific checks can fail the build if strict
        fi
        echo "‚úÖ Security check passed."

    - name: All Green
      run: echo "üéâ Antigravity Workflows integrity validated!"
