---
description: 系統性除錯工作流 (Systematic Debugging)
---

# 系統性除錯工作流 (Systematic Debugging)

> 觸發指令: `/debug`
> 用途: 四階段根因分析，科學化除錯

---

## 🎯 核心原則

```
╔═══════════════════════════════════════════════════════════════╗
║  NO FIXES WITHOUT ROOT CAUSE INVESTIGATION FIRST              ║
║  在找到根因之前，絕不進行任何修復                                ║
╚═══════════════════════════════════════════════════════════════╝
```

---

## 📋 四階段流程

### 階段 1️⃣ 根因調查 (Root Cause Investigation)

**目標**: 理解問題，而非急於修復

1. **收集資訊**
   - 錯誤訊息完整內容
   - 重現步驟（1, 2, 3...）
   - 發生環境（開發/測試/生產）
   - 最近的變更（git log）

2. **問題定位**
   - 錯誤發生的確切位置（檔案:行號）
   - 相關的輸入/輸出資料
   - 上下游影響範圍

3. **輸出格式**

   ```markdown
   ## 📍 問題定位
   - 檔案: [path/to/file.js:123]
   - 錯誤類型: [TypeError/ReferenceError/...]
   - 錯誤訊息: [完整訊息]
   - 影響範圍: [受影響的功能]
   ```

---

### 階段 2️⃣ 模式分析 (Pattern Analysis)

**目標**: 識別錯誤模式，查找相似問題

1. **搜尋歷史**
   - 搜尋 codebase 中相似的錯誤處理
   - 檢查 git blame 查看相關變更歷史
   - 查詢是否有類似的已修復 issue

2. **模式識別**
   - 這是常見的 N+1 查詢問題嗎？
   - 這是 race condition 嗎？
   - 這是 null/undefined 處理問題嗎？
   - 這是邊界條件問題嗎？

3. **輸出格式**

   ```markdown
   ## 🔍 模式分析
   - 錯誤模式: [識別的模式類型]
   - 相似案例: [codebase 中的類似問題]
   - 歷史記錄: [相關的 commit/issue]
   ```

---

### 階段 3️⃣ 假設測試 (Hypothesis Testing)

**目標**: 驗證根因假設，而非猜測修復

1. **建立假設**

   ```markdown
   假設: [具體的根因假設]
   預期: 如果假設正確，[預期的行為]
   驗證方法: [如何測試此假設]
   ```

2. **執行驗證**
   - 添加 log/斷點驗證假設
   - 撰寫最小重現測試
   - 逐步排除可能原因

3. **記錄結果**

   ```markdown
   ## 🧪 假設測試
   | 假設 | 驗證方法 | 結果 |
   |------|---------|------|
   | [假設1] | [方法] | ✅/❌ |
   | [假設2] | [方法] | ✅/❌ |
   ```

---

### 階段 4️⃣ 實施修復 (Implement Fix)

**目標**: 只有在確認根因後才進行修復

1. **修復方案**
   - 最小化變更原則
   - 避免引入新問題
   - 考慮向後相容性

2. **驗證修復**
   - 確認原問題已解決
   - 執行相關測試
   - 確認無迴歸問題

3. **輸出格式**

   ```markdown
   ## ✅ 修復完成

   ### 根因
   [確認的根本原因]

   ### 修復內容
   - 檔案: [修改的檔案]
   - 變更: [變更說明]

   ### 驗證
   - [x] 原問題已解決
   - [x] 測試通過
   - [x] 無迴歸影響

   ### 預防措施
   [如何避免類似問題再次發生]
   ```

---

## ❌ 禁止行為

1. **禁止盲目修復**: 不理解問題就嘗試修復
2. **禁止猜測**: 「可能是這個問題」然後就改程式碼
3. **禁止忽略測試**: 修復後不驗證
4. **禁止隱藏錯誤**: 用 try-catch 包住然後忽略
5. **禁止表演性修復**: 做出修改但不確認是否解決問題
